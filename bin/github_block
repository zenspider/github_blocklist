#!/usr/bin/env -S ruby -w

require "json"

# TODO: add syntax for comments
# TODO: add ability to set the note for the block, if that's ever allowed

abort "usage: #{$0} text_files..." if ARGV.empty?

def change ary, name, type
  return if ary.empty?
  puts "#{name}:"
  ary.sort.each do |nick|
    puts nick
    system "gh api --method #{type} /user/blocks/#{nick}"
  end
end

desired = ARGF.readlines(chomp: true).sort.uniq
current = JSON.parse(`gh api --paginate --slurp /user/blocks`)
  .flatten
  .map { |h| h["login"] }

change desired - current, "Adding",   "PUT"
change current - desired, "Deleting", "DELETE"
